---
sidebar_position: 7
title: "Le hook useContext de React"
description: "D√©couvrez comment utiliser le hook useContext de React pour g√©rer les contextes dans vos applications."
tags:
  - Frontend
  - React
  - JavaScript/TypeScript
  - Biblioth√®que
  - Interface utilisateur (UI)
---

import Button from '@site/src/components/Button';
import Quiz from '@site/src/components/Quiz';
import Admonition from '@theme/Admonition';
import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

# L'utilisation des contextes avec React

## Introduction

Les contextes sont un moyen de diffuser des donn√©es au travers des composants, sans avoir √† les passer explicitement √† chaque composant.  
Pour faire simple, imaginons une arborescence de plusieurs composants imbriqu√©s les uns dans les autres :

```tsx title="App.tsx" showLineNumbers
import type { Dispatch, SetStateAction } from 'react';

import { useState } from 'react';

type Theme = 'light' | 'dark';

const App = () => {
  const [theme, setTheme] = useState<Theme>('light');

  return <A theme={theme} setTheme={theme} />
};

const A = ({ theme, setTheme }: { theme: Theme, setTheme: Dispatch<SetStateAction<Theme>> }) => {
  return <B theme={theme} setTheme={setTheme} />
};

const B = ({ theme, setTheme }: { theme: Theme, setTheme: Dispatch<SetStateAction<Theme>> }) => {
  return <C theme={theme} setTheme={setTheme} />
};
```

Fastidieux, n'est-ce pas ? On transmet √† chaque fois les m√™mes donn√©es, et ce, √† chaque niveau de l'arborescence.

C'est l√† que les contextes entrent en jeu !  
On va pouvoir alors d√©clarer notre contexte _(qui contiendra les donn√©es √† diffuser)_ et le fournir √† un niveau sup√©rieur de l'arborescence.

## D√©claration d'un contexte

Avant de penser √† notre contexte, on va r√©fl√©chir √† ce que l'on veut diffuser et les valeurs par d√©faut.  
Si on reprend notre exemple avec le th√®me clair et sombre, on sait que l'on va vouloir diffuser la valeur du th√®me et une fonction pour le changer.

On va donc pr√©parer le terrain en cr√©ant un fichier `ThemeContext.tsx` :

```tsx title="ThemeContext.tsx" showLineNumbers
import type { Dispatch, SetStateAction } from 'react';

import { createContext } from 'react';

type Theme = 'light' | 'dark';

type ThemeContextType = {
  theme: Theme;
  setTheme: Dispatch<SetStateAction<Theme>>;
};
```

Mais √©videmment, on ne peut pas s'arr√™ter l√†.  
Pour le moment nous n'avons que la forme de notre contexte, il va falloir le cr√©er et le fournir √† notre arborescence de composants.

```tsx title="ThemeContext.tsx"
// On cr√©e notre contexte, avec une valeur par d√©faut : un th√®me clair
const ThemeContext = createContext<ThemeContextType>({
  theme: 'light',
  setTheme: () => {},
});
```

## Fournir un contexte

Maintenant on peut le dire : notre contexte est pr√™t √† √™tre utilis√© !  
Il ne reste plus qu'√† le fournir √† notre arborescence de composants en lui cr√©ant un `Provider`.

<Admonition type="quote" title="Un Provider ?">
  Un `Provider` est un composant qui va permettre de diffuser les donn√©es du contexte √† ses enfants.  
  Il est important de noter que le `Provider` doit √™tre plac√© **au-dessus** des composants qui vont utiliser le contexte.
</Admonition>

Un contexte React est un objet qui contient deux propri√©t√©s : `Provider` et `Consumer`.  
Le `Provider` est un composant qui va permettre de diffuser les donn√©es du contexte √† ses enfants.  
Le `Consumer` est un composant qui va permettre de r√©cup√©rer les donn√©es du contexte.

```tsx title="App.tsx"
import { useState } from 'react';

const App = () => {
  const [theme, setTheme] = useState<Theme>('light');

  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      <A />
    </ThemeContext.Provider>
  );
};
```

Mais on peut aller encore plus loin, en cr√©ant un `Provider` d√©di√© √† notre contexte !  
Cela permettra de simplifier l'arborescence de composants et de rendre le code plus lisible :

```tsx title="ThemeContext.tsx" {21-29} showLineNumbers
import type { ReactNode } from 'react';

import { createContext, useState } from 'react';

type Theme = 'light' | 'dark';

type ThemeContextType = {
  theme: Theme;
  setTheme: Dispatch<SetStateAction<Theme>>;
};

const ThemeContext = createContext<ThemeContextType>({
  theme: 'light',
  setTheme: () => {},
});

type ThemeProviderProps = {
  children: ReactNode;
};

const ThemeProvider = ({ children }: ThemeProviderProps) => {
  const [theme, setTheme] = useState<Theme>('light');

  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

export { ThemeContext, ThemeProvider };
```

Et pour terminer, on va maintenant pouvoir directement imbriquer notre `ThemeProvider` dans notre `App` :

```tsx title="App.tsx" {1,5-7} showLineNumbers
import { ThemeProvider } from './ThemeContext';

const App = () => {
  return (
    <ThemeProvider>
      <A />
    </ThemeProvider>
  );
};
```

## Utilisation d'un contexte

C'est bien beau de cr√©er un contexte, mais comment l'utiliser ?  
Tu te souviens peut-√™tre du `Consumer` que l'on a √©voqu√© plus t√¥t, non ?

Et bien, il est temps de le mettre en pratique ! üòÅ

Pour commencer, nous allons avoir besoin du fameux hook `useContext` de React.  
Ce hook va nous permettre de r√©cup√©rer les donn√©es du contexte, et ce, directement dans nos composants.
  
```tsx title="C.tsx"
import { useContext } from 'react';
```

Ensuite, on pensera √† importer le contexte que l'on souhaite utiliser :

```tsx title="C.tsx"
import { ThemeContext } from './ThemeContext';
```

Et enfin, on va pouvoir utiliser le hook `useContext` pour r√©cup√©rer les donn√©es du contexte :

```tsx title="C.tsx"
const C = () => {
  const { theme, setTheme } = useContext(ThemeContext);

  return (
    <>
      {/** JSX */}
    </>
  );
};
```

Pas mal, non ? üòâ  
Fini l'arborscence de composants √† rallonge, on peut maintenant r√©cup√©rer les donn√©es du contexte directement dans nos composants !

## Les d√©fauts des contextes

Seulement... Un grand pouvoir implique de grandes responsabilit√©s. üï∑Ô∏è

Bien que les contextes soient tr√®s pratiques, il faut prendre en compte quelques points :

- On ne peut pas utiliser les contextes pour tout et n'importe quoi.  
  Ils sont plut√¥t adapt√©s pour diffuser des donn√©es qui sont utilis√©es par plusieurs composants.
- Les contextes peuvent rendre le code plus difficile √† comprendre.
- L'utilisation de nombreux contextes va faire appara√Ætre ce qu'on appelle le **context hell**.

### Le context hell

Dans cet article, nous avons vu comment cr√©er un contexte et l'utiliser.  
Et par chance, nous n'avons pas encore rencontr√© le **context hell**.

Mais maintenant, que se passe-t-il si on a besoin de plusieurs contextes _(plusieurs dizaines par exemple !)_ dans notre application ?  
On va se retrouver avec une arborescence de composants qui va devenir de plus en plus difficile √† comprendre et √† maintenir.

Et c'est √ßa, le **context hell**.

<Admonition type="example" title="Exemple de context hell">  
  ```tsx
root.render(
  <StrictMode>
    <UserProvider>
      <ThemeProvider>
        <LanguageProvider>
          <PostProvider>
            <SettingsProvider>
              <SocketProvider>
                <FriendProvider>
                  <NotificationProvider>
                    <ChatProvider>
                      <MusicProvider>
                        <VideoProvider>
                          <GameProvider>
                            <WeatherProvider>
                              <NewsProvider>
                                <CalendarProvider>
                                  <TaskProvider>
                                    <NoteProvider>
                                      <App />
                                    </NoteProvider>
                                  </TaskProvider>
                                </CalendarProvider>
                              </NewsProvider>
                            </WeatherProvider>
                          </GameProvider>
                        </VideoProvider>
                      </MusicProvider>
                    </ChatProvider>
                  </NotificationProvider>
                </FriendProvider>
              </SocketProvider>
            </SettingsProvider>
          </PostProvider>
        </LanguageProvider>
      </ThemeProvider>
    </UserProvider>
  </StrictMode>
);
  ```

  Maintenant, demande √† un d√©veloppeur d'inverser le provider `UserProvider` avec le provider `NoteProvider`.  
  C'est jouable sans difficult√©, mais si tu entends des cris de d√©sespoir, c'est normal. üòÖ
</Admonition>

Pour √©viter de tomber dans le **context hell**, il est important de bien r√©fl√©chir √† l'utilisation des contextes dans notre application avec ces quelques questions :

- Est-ce que l'utilisation d'un contexte est vraiment n√©cessaire pour ce cas d'usage ?
- Est-ce que le contexte est utilis√© par plusieurs composants ?
- Est-ce que le contexte est utilis√© par des composants √©loign√©s dans l'arborescence ?

Mais alors, si tu as besoin d'autant de contextes dans ton application, comment faire ?  
Et bien, il existe des solutions pour √©viter le **context hell** :

- Utiliser des biblioth√®ques tierces comme Redux _(solution lourde, mais tr√®s puissante)_
- Cr√©er un nouveau composant qui va regrouper tous les contextes _(solution plus l√©g√®re, mais plus difficile √† maintenir)_

N'√©tant pas un grand fan de Redux, je te conseille plut√¥t la deuxi√®me solution.  
Mais si tu veux en savoir plus sur Redux, n'h√©site pas √† consulter la [documentation officielle](https://redux.js.org/) !

### R√©soudre le context hell avec un composant d√©di√©

Parlons de ce fameux composant qui va regrouper tous les contextes !  
On ne parle pas ici d'un simple composant `Providers` qui va imbriquer tous les `Provider` de nos contextes, mais d'une solution plus √©l√©gante.

Apr√®s tout, nous sommes des ~feignants~ d√©veloppeurs, non ? üòè

R√©fl√©chissons √† ce que l'on veut faire :

- On veut pouvoir regrouper tous les contextes dans un seul composant.
- On veut pouvoir ajouter ou supprimer des contextes facilement.
- On veut pouvoir facilement les ordonner entre eux.
- On veut √©viter le **context hell**.